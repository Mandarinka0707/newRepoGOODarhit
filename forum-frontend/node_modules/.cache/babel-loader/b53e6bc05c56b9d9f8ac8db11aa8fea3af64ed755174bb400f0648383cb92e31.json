{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nconst useWebSocket = url => {\n  _s();\n  const [socket, setSocket] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [connectionStatus, setConnectionStatus] = useState('disconnected');\n  useEffect(() => {\n    if (!url) return;\n    let ws;\n    let reconnectInterval;\n    const connect = () => {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        setConnectionStatus('unauthenticated');\n        return;\n      }\n      ws = new WebSocket(`${url}?token=${encodeURIComponent(token)}`);\n      ws.onopen = () => {\n        console.log('WebSocket connected');\n        setConnectionStatus('connected');\n        setSocket(ws);\n      };\n      ws.onmessage = event => {\n        try {\n          const newMessage = JSON.parse(event.data);\n          setMessages(prev => [...prev, newMessage]);\n        } catch (err) {\n          console.error('Error parsing message:', err);\n        }\n      };\n      ws.onclose = event => {\n        console.log('WebSocket closed:', event.code, event.reason);\n        setConnectionStatus('disconnected');\n        if (event.code !== 1000) {\n          // 1000 = normal closure\n          reconnectInterval = setTimeout(() => {\n            setConnectionStatus('reconnecting');\n            connect();\n          }, 5000);\n        }\n      };\n      ws.onerror = error => {\n        console.error('WebSocket error:', error);\n        setConnectionStatus('error');\n      };\n    };\n    connect();\n    return () => {\n      if (ws) {\n        ws.close(1000, 'Component unmounted');\n      }\n      clearTimeout(reconnectInterval);\n    };\n  }, [url]);\n  const sendMessage = message => {\n    if (socket && socket.readyState === WebSocket.OPEN) {\n      socket.send(JSON.stringify(message));\n    } else {\n      console.error('Cannot send message - WebSocket not connected');\n    }\n  };\n  return {\n    socket,\n    messages,\n    sendMessage,\n    connectionStatus\n  };\n};\n_s(useWebSocket, \"IhKKRB2Nnw9qvmZutzwECZ0X7o4=\");\nexport default useWebSocket;","map":{"version":3,"names":["useState","useEffect","useWebSocket","url","_s","socket","setSocket","messages","setMessages","connectionStatus","setConnectionStatus","ws","reconnectInterval","connect","token","localStorage","getItem","WebSocket","encodeURIComponent","onopen","console","log","onmessage","event","newMessage","JSON","parse","data","prev","err","error","onclose","code","reason","setTimeout","onerror","close","clearTimeout","sendMessage","message","readyState","OPEN","send","stringify"],"sources":["/Users/darinautalieva/Desktop/GOProject/forum-frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useState, useEffect } from 'react';\n\nconst useWebSocket = (url) => {\n    const [socket, setSocket] = useState(null);\n    const [messages, setMessages] = useState([]);\n    const [connectionStatus, setConnectionStatus] = useState('disconnected');\n\n    useEffect(() => {\n        if (!url) return;\n\n        let ws;\n        let reconnectInterval;\n\n        const connect = () => {\n            const token = localStorage.getItem('token');\n            if (!token) {\n                setConnectionStatus('unauthenticated');\n                return;\n            }\n\n            ws = new WebSocket(`${url}?token=${encodeURIComponent(token)}`);\n\n            ws.onopen = () => {\n                console.log('WebSocket connected');\n                setConnectionStatus('connected');\n                setSocket(ws);\n            };\n\n            ws.onmessage = (event) => {\n                try {\n                    const newMessage = JSON.parse(event.data);\n                    setMessages(prev => [...prev, newMessage]);\n                } catch (err) {\n                    console.error('Error parsing message:', err);\n                }\n            };\n\n            ws.onclose = (event) => {\n                console.log('WebSocket closed:', event.code, event.reason);\n                setConnectionStatus('disconnected');\n                if (event.code !== 1000) { // 1000 = normal closure\n                    reconnectInterval = setTimeout(() => {\n                        setConnectionStatus('reconnecting');\n                        connect();\n                    }, 5000);\n                }\n            };\n\n            ws.onerror = (error) => {\n                console.error('WebSocket error:', error);\n                setConnectionStatus('error');\n            };\n        };\n\n        connect();\n\n        return () => {\n            if (ws) {\n                ws.close(1000, 'Component unmounted');\n            }\n            clearTimeout(reconnectInterval);\n        };\n    }, [url]);\n    const sendMessage = (message) => {\n        if (socket && socket.readyState === WebSocket.OPEN) {\n            socket.send(JSON.stringify(message));\n        } else {\n            console.error('Cannot send message - WebSocket not connected');\n        }\n    };\n\n    return { socket, messages, sendMessage, connectionStatus };\n};\n\nexport default useWebSocket;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}